name: ABI

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    continue-on-error: true

    steps:
      - name: Install System dependencies
        run: |
          sudo apt update
          sudo apt install -y abi-compliance-checker
      - name: Download previous version
        run: |
          wget https://github.com/HDFGroup/hdf5/releases/download/hdf5-1_14_3/hdf5-1_14_3-ubuntu-2204.tar.gz
          tar zxvf hdf5-1_14_3-ubuntu-2204.tar.gz
          find .
      - name: Download current version
        run: |
          wget https://github.com/HDFGroup/hdf5/releases/download/snapshot/last-file.txt
          cat last-file.txt
          echo "HDF5_NAME_BASE=$(cat last-file.txt)" >> $GITHUB_ENV
      - name: Use the variable in a subsequent step
        env:
          H5: $HDF5_NAME_BASE
        run: |
          echo $H5
          wget https://github.com/HDFGroup/hdf5/releases/download/snapshot/$H5.tar.gz
          tar zxvf $H5.tar.gz
          ls
          wget https://github.com/HDFGroup/hdf5/releases/download/snapshot/$HDF5_NAME_BASE.tar.gz
          tar zxvf $HDF5_NAME_BASE.tar.gz
