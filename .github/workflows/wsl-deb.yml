name: wsl deb
on:
  workflow_dispatch:
  push:
    branches: [ main- ]

jobs:
  debian-test:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Debian WSL
        uses: Vampire/setup-wsl@v6
        with:
          distribution: Debian
          use-cache: true

      - name: Fix Repository Issues
        shell: wsl-bash {0}
        run: |
          echo "=== Current System Info ==="
          cat /etc/os-release
          echo ""

          echo "=== Current Sources ==="
          cat /etc/apt/sources.list
          echo ""

          echo "=== Cleaning up problematic repositories ==="
          # Remove any backports or problematic entries
          sudo sed -i '/bullseye-backports/d' /etc/apt/sources.list
          sudo sed -i '/bullseye\/updates/d' /etc/apt/sources.list

          # Remove any additional sources that might cause issues
          sudo rm -f /etc/apt/sources.list.d/*backports* 2>/dev/null || true

          echo "=== Updated Sources ==="
          cat /etc/apt/sources.list

      - name: Update Package Lists
        shell: wsl-bash {0}
        run: |
          sudo apt clean
          sudo apt update

      - name: Install Basic Tools
        shell: wsl-bash {0}
        run: |
          sudo apt install -y \
            curl \
            wget \
            git \
            build-essential \
            python3 \
            python3-pip
