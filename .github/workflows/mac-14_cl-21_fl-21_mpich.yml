name: mac-14 clang-21 flang-21 mpich-dev

on:
  push:
    branches:
      - main
jobs:
  test:
    name: mac-14 clang-21 flang-21 mpich-dev
    runs-on: macos-14
    steps:
    - name: checkout mpich
      uses: actions/checkout@v6
      with:
        repository: pmodels/mpich
        submodules: recursive
    - name: install
      run: |
         brew install autoconf automake flang libtool lld
    - name: configure
      run: |
        find /opt/homebrew/
        export CC=/opt/homebrew/opt/bin/clang-21
        export CXX=/opt/homebrew/opt/bin/clang++-21
        export FC=/opt/homebrew/opt/bin/flang-21
        export F77=/opt/homebrew/opt/bin/flang-21
        export LDFLAGS="-Wl,-ld_classic -L/opt/homebrew/opt/llvm/lib"
        ./autogen.sh
        ./configure --prefix=$PWD/install \
          --enable-fortran \
          --disable-weak-symbols \
          CC=$CC CXX=$CXX FC=$FC F77=$FC
