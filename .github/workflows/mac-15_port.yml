name: mac-15 port

on:
  push:
    branches: main

jobs:
  build:
    runs-on: macos-15
    steps:
      - name: get
        run: |
          curl -O -L   https://github.com/macports/macports-base/releases/download/v2.11.5/MacPorts-2.11.5-15-Sequoia.pkg
      - name: install
        run: |
          ls -l
          sudo installer -pkg MacPorts-2.11.5-15-Sequoia.pkg -target /
      - name: update
        run: |
          export PATH=/opt/local/bin:/opt/local/sbin:$PATH
          ls -l /opt/local/bin
          ls -l /opt/local/sbin
          sudo port selfupdate
      - name: install
        run: |
          export PATH=/opt/local/bin:/opt/local/sbin:$PATH          
          port version
          sudo port install mpich-clang
          sudo port select --set mpi mpich-clang-fortran
          git clone https://github.com/HDFGroup/hdf5
          cd hdf5
          mkdir build
          cd build
          cmake -DCMAKE_C_COMPILER=mpicc -DCMAKE_Fortran_COMPILER=mpifort \
            -DHDF5_BUILD_FORTRAN:BOOL=ON -DHDF5_ENABLE_PARALLEL:BOOL=ON ..
          ctest -T Build
          ctest -C Release -T Test
